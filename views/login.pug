extends layout

block content
  h1 Login
  //- form(action="/users/login" method="POST")
  //-   label(for="username1") Username 
  //-   input(type="text" name="username" id="username1" required)
  //-   label(for="password") Password 
  //-   input(type="password" name="password" id="password" required)
  //-   button(class="btn" type="submit") Login

  form#loginForm(action="/users/login", method="POST")
    label(for="email_input", class='label-focus') Email:
    input(type="email", id="email_input", name="email", required)

    label(for="password_input", class='label-focus') Password: 
    input(type="password", id="password_input", name="password", required)

    input(type="submit", value="Login", class="btn") 

  script.
    document.addEventListener('DOMContentLoaded', function() {
      const loginForm = document.getElementById('loginForm');

      loginForm.addEventListener('submit', function(event) {
        event.preventDefault();

        const email = document.getElementById('email_input').value;
        const password = document.getElementById('password_input').value;

        // Send login request to the server
        fetch('/users/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email, password })
        })
        .then(response => response.json())
        .then(data => {
          if (data.token) {
            // Save the token to local storage
            localStorage.setItem('auth_token', data.token);

            // Redirect to the home page ("/")
            window.location.href = '/';
          } else {
            // Handle unsuccessful login (display an error message, etc.)
            console.error('Login failed:', data.error);
          }
        })
        .catch(error => console.error('Error during login:', error));
      });
    });


  